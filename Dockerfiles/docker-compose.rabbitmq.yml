# ############### RabbitMQ - Message Broker ###############
#
# Used by: marie-ai for async task processing
#
# RabbitMQ provides message queuing for distributed task execution.
#
# Prerequisites:
#   - Network created: docker network create --driver=bridge marie_default
#
# Usage:
#   docker compose --env-file ./config/.env -f ./Dockerfiles/docker-compose.rabbitmq.yml --project-directory . up -d
#
# Access:
#   - AMQP: localhost:5672
#   - Management UI: http://localhost:15672 (use RABBIT_MQ_USERNAME/RABBIT_MQ_PASSWORD from .env)

services:
  rabbitmq:
    image: rabbitmq:3-management-alpine
    restart: unless-stopped
    container_name: 'marie-rabbitmq'
    ports:
        - 5672:5672 # AMQP
        - 15672:15672 # HTTP
    environment:
        - RABBITMQ_DEFAULT_USER=${RABBIT_MQ_USERNAME:-marie}
        - RABBITMQ_DEFAULT_PASS=${RABBIT_MQ_PASSWORD:-mariepassword}
        - RABBITMQ_DEFAULT_VHOST=/
    volumes:
        - rabbitmq_data:/var/lib/rabbitmq
        - rabbitmq_log:/var/log/rabbitmq
    networks:
        - marie_default

volumes:
  rabbitmq_data:
    driver: local
  rabbitmq_log:
    driver: local

# ############### Networks ###############
networks:
  marie_default:
    external: true
