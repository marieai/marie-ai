"use strict";(self.webpackChunkmare_ai=self.webpackChunkmare_ai||[]).push([[7661],{24799:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>m,frontMatter:()=>s,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"getting-started/job-management/maintenance","title":"Maintenance","description":"list all jobs","source":"@site/docs/getting-started/job-management/maintenance.md","sourceDirName":"getting-started/job-management","slug":"/getting-started/job-management/maintenance","permalink":"/docs/getting-started/job-management/maintenance","draft":false,"unlisted":false,"editUrl":"https://github.com/marieai/marie-ai/tree/main/docs/docs/getting-started/job-management/maintenance.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Job Management","permalink":"/docs/category/job-management"},"next":{"title":"Fundamentals","permalink":"/docs/category/fundamentals"}}');var r=t(74848),i=t(28453);const s={sidebar_position:3},c="Maintenance",o={},l=[{value:"list all jobs",id:"list-all-jobs",level:2},{value:"Purge all jobs",id:"purge-all-jobs",level:2},{value:"Create queue",id:"create-queue",level:2},{value:"Get the next job in DAG( Directed Acyclic Graph)",id:"get-the-next-job-in-dag-directed-acyclic-graph",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"maintenance",children:"Maintenance"})}),"\n",(0,r.jsx)(n.h2,{id:"list-all-jobs",children:"list all jobs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select * from marie_scheduler.job\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT *\nFROM marie_scheduler.job\nWHERE data->'metadata'->>'doc_type' = 'doc_type'\nAND data->'metadata'->>'doc_id' = 'doc_id_0001'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"purge-all-jobs",children:"Purge all jobs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"\nTRUNCATE marie_scheduler.job;\nTRUNCATE marie_scheduler.job_history;\nTRUNCATE kv_store_worker;\nTRUNCATE kv_store_worker_history;\n\n"})}),"\n",(0,r.jsx)(n.h2,{id:"create-queue",children:"Create queue"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT marie_scheduler.create_queue('extract', '{\"retry_limit\":1}'::json)\nSELECT marie_scheduler.create_queue('extract', '{\"retry_limit\":2}'::json)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"get-the-next-job-in-dag-directed-acyclic-graph",children:"Get the next job in DAG( Directed Acyclic Graph)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT j.*\nFROM marie_scheduler.job AS j\nWHERE j.state < 'active'\n  AND NOT EXISTS (\n      SELECT 1\n      FROM marie_scheduler.job AS d\n      WHERE d.id IN (\n          SELECT value::uuid\n          FROM jsonb_array_elements_text(j.dependencies)  -- or jsonb_array_elements() if storing as JSONB\n      )\n      AND d.state != 'completed'\n  )\nORDER BY j.priority DESC, j.created_on ASC\nLIMIT 1\n"})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var a=t(96540);const r={},i=a.createContext(r);function s(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);