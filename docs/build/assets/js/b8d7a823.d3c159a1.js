"use strict";(self.webpackChunkmare_ai=self.webpackChunkmare_ai||[]).push([[2952],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var o=t(96540);const r={},s=o.createContext(r);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(s.Provider,{value:n},e.children)}},65433:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"extract/annotators/annotators-config","title":"Configuration: directory structure, prompt resolution, and examples","description":"This section describes how annotators are configured, where prompts live, and how the system locates and loads them at runtime.","source":"@site/docs/extract/annotators/annotators-config.md","sourceDirName":"extract/annotators","slug":"/extract/annotators/annotators-config","permalink":"/docs/extract/annotators/annotators-config","draft":false,"unlisted":false,"editUrl":"https://github.com/marieai/marie-ai/tree/main/docs/docs/extract/annotators/annotators-config.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"How to add a new annotator","permalink":"/docs/extract/annotators/annotators-add"},"next":{"title":"Purpose and How They Fit Into the System","permalink":"/docs/extract/annotators/"}}');var r=t(74848),s=t(28453);const a={},i="Configuration: directory structure, prompt resolution, and examples",l={},c=[{value:"Config directory layout",id:"config-directory-layout",level:3},{value:"Prompt path resolution",id:"prompt-path-resolution",level:3},{value:"Annotator selection at runtime",id:"annotator-selection-at-runtime",level:3},{value:"Example YAML configuration",id:"example-yaml-configuration",level:3},{value:"Field-by-field guidance",id:"field-by-field-guidance",level:3},{value:"Best practices",id:"best-practices",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3}];function d(e){const n={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configuration-directory-structure-prompt-resolution-and-examples",children:"Configuration: directory structure, prompt resolution, and examples"})}),"\n",(0,r.jsx)(n.p,{children:"This section describes how annotators are configured, where prompts live, and how the system locates and loads them at runtime."}),"\n",(0,r.jsx)(n.h3,{id:"config-directory-layout",children:"Config directory layout"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All prompt paths are resolved relative to the config base directory, which defaults to: ",(0,r.jsx)(n.code,{children:"__config_dir__/extract/"})]}),"\n",(0,r.jsx)(n.li,{children:"Typical structure:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plain",metastring:"text",children:"g5/\n  config/\n    base-config.yml\n    field-config.yml\n  TID-<layout_id>/\n    annotator/\n      config.yml\n      <prompt_a>.j2\n      <prompt_b>.j2\n      <prompt_c>.j2\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<layout_id>"})," identifies the target document layout. Each layout keeps its own annotator config and prompt files under ",(0,r.jsx)(n.code,{children:"TID-<layout_id>/annotator/"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"prompt-path-resolution",children:"Prompt path resolution"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"model_config.prompt_path"})," is treated as a path relative to the configuration base. For example:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'prompt_path: "./claims.j2"'})," is resolved within ",(0,r.jsx)(n.code,{children:"TID-<layout_id>/annotator/claims.j2"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["You can also supply an absolute prompt (e.g., via an alternate config root), but best practice is to keep prompts co-located with the annotator config for a specific layout under ",(0,r.jsx)(n.code,{children:"TID-<layout_id>/annotator/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["If both ",(0,r.jsx)(n.code,{children:"prompt_path"})," and ",(0,r.jsx)(n.code,{children:"system_prompt_text"})," are present, the system uses ",(0,r.jsx)(n.code,{children:"system_prompt_text"})," as the system role content and the Jinja2 prompt template as the user/content portion. This makes it easy to:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep a stable system prompt that describes the task."}),"\n",(0,r.jsx)(n.li,{children:"Swap prompt templates per layout or per annotator."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"annotator-selection-at-runtime",children:"Annotator selection at runtime"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A job selects:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The annotator key (e.g., ",(0,r.jsx)(n.code,{children:"claims"}),", ",(0,r.jsx)(n.code,{children:"tables"}),", ",(0,r.jsx)(n.code,{children:"key-values"}),") to specify which annotator to run."]}),"\n",(0,r.jsxs)(n.li,{children:["The target ",(0,r.jsx)(n.code,{children:"layout_id"})," to locate the right ",(0,r.jsx)(n.code,{children:"TID-<layout_id>/annotator/config.yml"})," and its referenced prompt files."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"This keeps runtime requests small and declarative while enabling per-layout customization."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example-yaml-configuration",children:"Example YAML configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# ALL prompt paths are relative to the config base directory defaulting to `__config_dir__/extract/`\n\n# Structure of the config directory:\n#   - g5/\n#     - config/\n#       - base-config.yml\n#       - field-config.yml\n#     - TID-<layout_id>/\n#       - annotator/\n#         - config.yml\n#         - <prompt_a>.j2\n#         - <prompt_b>.j2\n#         - <prompt_c>.j2\n\nannotators:\n  # KEY-VALUE ANNOTATOR\n  key-values:\n    annotator_type: "llm"\n    model_config:\n      model_name: deepseek_r1_32\n      prompt_path: "./key-value.j2"\n      system_prompt_text: >\n        ### Task\n        You are a helpful assistant that extracts claims from the given text.\n      top_p: 1.0\n      frequency_penalty: 0\n      presence_penalty: 0\n      expect_output: "json"\n\n    parser_name: default # parser to parse the key-value pairs\n    validators: # Custom validators for key-values\n      - "key-values"\n      - "document_structure"\n\n\n  # CLAIMS ANNOTATOR\n  claims:\n    annotator_type: "llm"\n    model_config:\n      model_name: deepseek_r1_32\n      prompt_path: "./claims.j2"\n      system_prompt_text: >\n        ### Task\n        You are a helpful assistant that extracts claims from the given text.\n      top_p: 1.0\n      frequency_penalty: 0\n      presence_penalty: 0\n      expect_output: "json"\n    parser_name: default # parser to parse the claims\n    validators: # Custom validators for claims\n      - "claims"\n      - "document_structure"\n\n  # TABLE ANNOTATOR\n  tables:\n    annotator_type: "llm"\n    model_config:\n      model_name: deepseek_r1_32\n      prompt_path: "./tables.j2"\n      system_prompt_text: >\n        ### Task\n        You are a helpful assistant that extracts claims from the given text.\n      top_p: 1.0\n      frequency_penalty: 0\n      presence_penalty: 0\n      expect_output: "json"\n\n    parser_name: default # parser to parse the tables\n    validators: # Custom validators for tables\n        - "tables"\n        - "document_structure"\n\n  # REMARK ANNOTATOR\n  remarks:\n    annotator_type: "llm"\n    model_config:\n      model_name: deepseek_r1_32\n      prompt_path: "./remarks.j2"\n      system_prompt_text: >\n        ### Task\n        You are a helpful assistant that extracts remarks from the given text.\n      top_p: 1.0\n      frequency_penalty: 0\n      presence_penalty: 0\n      expect_output: "json"\n\n    parser_name: default # parser to parse the remarks\n    validators: # Custom validators for remarks\n      - "remarks"\n      - "document_structure"\n\n  # TABLE ExTRACTOR\n  table-extract:\n    annotator_type: "llm_table"\n    parser: noop #other parser will be used to parse the table\n\n    model_config:\n      model_name: qwen_v2_5_vl\n      prompt_path: "./table-extract.j2"\n      multimodal: true\n      system_prompt_text: >\n        ### Task\n        You are a helpful assistant that extracts tables from the given text.\n      top_p: 1.0\n      frequency_penalty: 0\n      presence_penalty: 0\n      expect_output: "markdown"\n\n# Grounding keys should be defined in the child config\n'})}),"\n",(0,r.jsx)(n.h3,{id:"field-by-field-guidance",children:"Field-by-field guidance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["annotators: A map of annotator keys (e.g., ",(0,r.jsx)(n.code,{children:"claims"}),", ",(0,r.jsx)(n.code,{children:"tables"}),"). Each key is how you select an annotator at runtime."]}),"\n",(0,r.jsxs)(n.li,{children:["annotator_type:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"llm"'}),": A general-purpose LLM annotator for key-values, claims, remarks, and similar tasks."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"llm_table"'}),": Specialized annotator for table understanding and extraction."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["model_config:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"model_name: The model identifier to use."}),"\n",(0,r.jsx)(n.li,{children:"prompt_path: Relative path (from the layout\u2019s annotator directory) to a Jinja2 prompt template."}),"\n",(0,r.jsx)(n.li,{children:"system_prompt_text: Optional system-level instructions. Recommended for stable task framing across templates."}),"\n",(0,r.jsx)(n.li,{children:"multimodal: Set true when the model supports and should consume images in addition to text."}),"\n",(0,r.jsx)(n.li,{children:"top_p, frequency_penalty, presence_penalty: Sampling and output-shaping parameters (tune per task as needed)."}),"\n",(0,r.jsxs)(n.li,{children:["expect_output: Hints how the downstream parser should treat model responses (e.g., ",(0,r.jsx)(n.code,{children:'"json"'})," or ",(0,r.jsx)(n.code,{children:'"markdown"'}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["parser_name / parser:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Name of the parser to apply to model outputs. Use ",(0,r.jsx)(n.code,{children:"noop"})," when the result is consumed by a different downstream parser (common for table pipelines)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["validators:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A list of validation profiles to run against extracted outputs. Useful for enforcing schema, structure, and domain-specific rules."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Grounding keys:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Keep layout-specific grounding in child configs under ",(0,r.jsx)(n.code,{children:"TID-<layout_id>"}),". This allows per-layout and per-annotator specialization without changing global configs."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"best-practices",children:"Best practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Co-locate prompts with the annotator config for the corresponding layout to keep deployments self-contained."}),"\n",(0,r.jsxs)(n.li,{children:["Reuse ",(0,r.jsx)(n.code,{children:"system_prompt_text"})," for stable, task-wide guardrails; vary ",(0,r.jsx)(n.code,{children:"prompt_path"})," for per-layout tuning."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"expect_output"})," to standardize downstream parsing workflows:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"json"'})," for key-values, claims, and remarks."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"markdown"'})," for table extractions where Markdown tables or structured text are desired."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["For multimodal table extraction, set ",(0,r.jsx)(n.code,{children:"multimodal: true"})," and ensure the prompt guides the model to consume visual table cues and return normalized structure."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prompt not found:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"prompt_path"})," is relative to the ",(0,r.jsx)(n.code,{children:"TID-<layout_id>/annotator/"})," directory and that the file exists."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Unexpected output shape:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Align ",(0,r.jsx)(n.code,{children:"expect_output"})," with your parser and adjust prompt templates to produce consistent JSON/Markdown."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Mixed layouts:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure the correct ",(0,r.jsx)(n.code,{children:"layout_id"})," is used so the proper ",(0,r.jsx)(n.code,{children:"TID-<layout_id>/annotator/config.yml"})," and prompts are loaded."]}),"\n"]}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);