"use strict";(self.webpackChunkmare_ai=self.webpackChunkmare_ai||[]).push([[5715],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},80427:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"getting-started/configuration/traefik","title":"Traefik","description":"Configuration is located in  config/traefik","source":"@site/docs/getting-started/configuration/traefik.md","sourceDirName":"getting-started/configuration","slug":"/getting-started/configuration/traefik","permalink":"/docs/getting-started/configuration/traefik","draft":false,"unlisted":false,"editUrl":"https://github.com/marieai/marie-ai/tree/main/docs/docs/getting-started/configuration/traefik.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Secrets","permalink":"/docs/getting-started/configuration/secrets"},"next":{"title":"Contribute","permalink":"/docs/category/contribute"}}');var s=t(74848),r=t(28453);const a={sidebar_position:2},o="Traefik",c={},d=[{value:"Authentication",id:"authentication",level:2},{value:"Basic Authentication",id:"basic-authentication",level:3},{value:"Hardcoded Authentication",id:"hardcoded-authentication",level:3},{value:"Certificates",id:"certificates",level:2},{value:"Localhost",id:"localhost",level:3},{value:"Making and trusting your own certificates",id:"making-and-trusting-your-own-certificates",level:4},{value:"Let&#39;s Encrypt",id:"lets-encrypt",level:3},{value:"Use Your Own Certificates",id:"use-your-own-certificates",level:3},{value:"Testing certificates",id:"testing-certificates",level:3},{value:"Testing configuration",id:"testing-configuration",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"traefik",children:"Traefik"})}),"\n",(0,s.jsxs)(n.p,{children:["Configuration is located in  ",(0,s.jsx)(n.code,{children:"config/traefik"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"./traefik/\n\u251c\u2500\u2500 file-provider.yml\n\u251c\u2500\u2500 prometheus-auth.yaml\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 traefik.yml\n\u2514\u2500\u2500 user-credentials\n"})}),"\n",(0,s.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsx)(n.h3,{id:"basic-authentication",children:"Basic Authentication"}),"\n",(0,s.jsxs)(n.p,{children:["Password should be generated using ",(0,s.jsx)(n.code,{children:"htpasswd"})," (md5, sha1 or bcrypt)"]}),"\n",(0,s.jsxs)(n.p,{children:["For passwords stored in ",(0,s.jsx)(n.code,{children:"user-credential"})," passwords need to be generated without escaping ",(0,s.jsx)(n.code,{children:"$"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"htpasswd -nb admin secure_password\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Set up the ",(0,s.jsx)(n.code,{children:"auth"})," middleware to be basicauth that takes a file for users"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'  middlewares:\n    auth:\n      basicAuth:\n        removeHeader: true\n        usersFile: /user-credentials\n#        users:\n#          - "dashboard:$apr1$2TgJEKkl$.fyRx.XI5l0AIm/bef4Rw."\n#    redirect-to-https:\n#      redirectScheme:\n#        scheme:\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"hardcoded-authentication",children:"Hardcoded Authentication"}),"\n",(0,s.jsxs)(n.p,{children:["For password hardcoded in middlewares directly via ",(0,s.jsx)(n.code,{children:"users"})," node."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"echo $(htpasswd -nB dashboard) | sed -e s/\\\\$/\\\\$\\\\$/g\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'  middlewares:\n    auth:\n      basicAuth:\n        removeHeader: true\n        users:\n          - "dashboard:$$2y$$05$$6zECIStqygUCGeKl/zog/up2Hu2vADiDJfw6SLd0cCSepU80czGS2"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"certificates",children:"Certificates"}),"\n",(0,s.jsxs)(n.p,{children:["Default configuration is located in ",(0,s.jsx)(n.code,{children:"./traefik/provider/tls.yml"})," if you need to add domain or change certificates you\ncan add them here."]}),"\n",(0,s.jsx)(n.h3,{id:"localhost",children:"Localhost"}),"\n",(0,s.jsxs)(n.p,{children:["For local development we follow a ",(0,s.jsx)(n.a,{href:"https://letsencrypt.org/docs/certificates-for-localhost/",children:"guide"})," created by ",(0,s.jsx)(n.a,{href:"http://letsencrypt.org",children:"letsencrypt.org"})]}),"\n",(0,s.jsx)(n.h4,{id:"making-and-trusting-your-own-certificates",children:"Making and trusting your own certificates"}),"\n",(0,s.jsxs)(n.p,{children:["The simplest way to generate a private key and self-signed certificate for ",(0,s.jsx)(n.code,{children:"localhost"})," is with this openssl command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"openssl req -x509 -out traefik.localhost.crt -keyout traefik.localhost.key \\\n  -newkey rsa:2048 -nodes -sha256 \\\n  -subj '/CN=traefik.localhost' -extensions EXT -config <( \\\n   printf \"[dn]\\nCN=traefik.localhost\\n[req]\\ndistinguished_name = dn\\n[EXT]\\nsubjectAltName=DNS:traefik.localhost\\nkeyUsage=digitalSignature\\nextendedKeyUsage=serverAuth\")\n"})}),"\n",(0,s.jsx)(n.p,{children:"Config for this option will look as follow:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"tls:\n  stores:\n    default:\n      defaultCertificate:\n        certFile: /letsencrypt/traefik.localhost.crt\n        keyFile: /letsencrypt/traefik.localhost.key\n"})}),"\n",(0,s.jsx)(n.h3,{id:"lets-encrypt",children:"Let's Encrypt"}),"\n",(0,s.jsx)(n.p,{children:"This process allows us to configure FQDN use Lets Encrypt as default ACME provider."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Dynamic Transport Layer Security configuration\n# https://doc.traefik.io/traefik/https/tls/\n\ntls:\n  stores:\n    default:\n      defaultGeneratedCert:\n        resolver: http-resolver\n        domain:\n          main: marie-ai.com\n          sans:\n            - ops-001.marie-ai.com\n\n  # When testing certs, enable this so traefik doesn't use its own self-signed cert for unknown domains.\n  options:\n    default:\n      sniStrict: false\n"})}),"\n",(0,s.jsx)(n.h3,{id:"use-your-own-certificates",children:"Use Your Own Certificates"}),"\n",(0,s.jsxs)(n.p,{children:["You wil need your certificate (.crt) and private key (.key) for each domain you like to use.\nThen add them in the ",(0,s.jsx)(n.code,{children:"tls.yml"})," configuration as follows."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"tls:\n  certificates:\n    - certFile: /certs/ops-001.marie-ai.com.crt\n      keyFile: /certs/ops-001.marie-ai.com.key\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing-certificates",children:"Testing certificates"}),"\n",(0,s.jsxs)(n.p,{children:["For testing, we will setup a virtual domain ",(0,s.jsx)(n.code,{children:"ops-001.marie-ai.com"})," and add it to our ",(0,s.jsx)(n.code,{children:"/etc/hosts"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cat /etc/hosts\n\n127.0.0.1\tlocalhost\n127.0.0.1   ops-001.marie-ai.com\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When testing certs, enable ",(0,s.jsx)(n.code,{children:"sniStrict"})," so traefik doesn't use its own self-signed cert for unknown domains.\nIf the validation fail for the domain you will get following error."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"SSL peer has no certificate for the requested DNS name\nError code: SSL_ERROR_UNRECOGNIZED_NAME_ALERT\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This error means that the name on the certificate is not recognized and is usually caused by a SSL configuration error.\nCheck ",(0,s.jsx)(n.code,{children:"sniStrict: false"})," is present."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Dynamic Transport Layer Security configuration\n# https://doc.traefik.io/traefik/https/tls/\n\ntls:\n  stores:\n    default:\n      defaultCertificate:\n        certFile: /letsencrypt/traefik.localhost.crt\n        keyFile: /letsencrypt/traefik.localhost.key\n#      ENABLE TO Auto Generate CERT\n#      defaultGeneratedCert:\n#        resolver: http-resolver\n#        domain:\n#          main: marie-ai.com\n#          sans:\n#            - ops-001.marie-ai.com\n\n  # When testing certs, enable this so traefik doesn't use its own self-signed cert for unknown domains.\n  options:\n    default:\n      sniStrict: false\n"})}),"\n",(0,s.jsx)(n.h2,{id:"testing-configuration",children:"Testing configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"docker compose down && docker compose -f docker-compose.yml --project-directory . up  traefik whoami  --build  --remove-orphans\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);