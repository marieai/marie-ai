"use strict";(self.webpackChunkmare_ai=self.webpackChunkmare_ai||[]).push([[2564],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>i});var a=n(96540);const r={},o=a.createContext(r);function s(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:t},e.children)}},41399:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"extract/annotators/annotators-add","title":"How to add a new annotator","description":"This section walks you through designing, configuring, and validating a new annotator. It applies to all annotator types (LLM, LLM Table, rule-based, embedding/hybrid) and follows the configuration and prompt layout described earlier.","source":"@site/docs/extract/annotators/annotators-add.md","sourceDirName":"extract/annotators","slug":"/extract/annotators/annotators-add","permalink":"/docs/extract/annotators/annotators-add","draft":false,"unlisted":false,"editUrl":"https://github.com/marieai/marie-ai/tree/main/docs/docs/extract/annotators/annotators-add.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Extract/Annotators","permalink":"/docs/category/extractannotators"},"next":{"title":"Configuration: directory structure, prompt resolution, and examples","permalink":"/docs/extract/annotators/annotators-config"}}');var r=n(74848),o=n(28453);const s={},i="How to add a new annotator",l={},d=[{value:"1) Choose the annotator type",id:"1-choose-the-annotator-type",level:3},{value:"2) Create or reuse prompts (if applicable)",id:"2-create-or-reuse-prompts-if-applicable",level:3},{value:"3) Add the annotator config entry",id:"3-add-the-annotator-config-entry",level:3},{value:"4) Parsers and validators (optional but recommended)",id:"4-parsers-and-validators-optional-but-recommended",level:3},{value:"5) Grounding keys and layout-specific settings",id:"5-grounding-keys-and-layout-specific-settings",level:3},{value:"6) Naming and conventions",id:"6-naming-and-conventions",level:3},{value:"7) Test and validate",id:"7-test-and-validate",level:3},{value:"8) Performance and cost tips",id:"8-performance-and-cost-tips",level:3},{value:"9) Troubleshooting",id:"9-troubleshooting",level:3},{value:"10) Minimal templates to copy",id:"10-minimal-templates-to-copy",level:3}];function c(e){const t={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"how-to-add-a-new-annotator",children:"How to add a new annotator"})}),"\n",(0,r.jsx)(t.p,{children:"This section walks you through designing, configuring, and validating a new annotator. It applies to all annotator types (LLM, LLM Table, rule-based, embedding/hybrid) and follows the configuration and prompt layout described earlier."}),"\n",(0,r.jsx)(t.h3,{id:"1-choose-the-annotator-type",children:"1) Choose the annotator type"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"llm: General-purpose extraction (key-values, claims, remarks, summaries)."}),"\n",(0,r.jsx)(t.li,{children:"llm_table: Table-specific extraction with optional multimodal vision."}),"\n",(0,r.jsx)(t.li,{children:"regex or rule-based: Deterministic pattern matching (IDs, dates, totals)."}),"\n",(0,r.jsx)(t.li,{children:"embedding/hybrid: Robust matching under noisy OCR or variable terminology."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Pick the simplest type that satisfies your requirements. Favor llm for flexible semantics; llm_table for structured tabular data; regex for stable, patterned fields; hybrid for noisy/variable inputs."}),"\n",(0,r.jsx)(t.h3,{id:"2-create-or-reuse-prompts-if-applicable",children:"2) Create or reuse prompts (if applicable)"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Place prompt templates in the layout\u2019s annotator directory:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"TID-layout_id/annotator/your-prompt.j2"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.li,{children:"Keep a stable task-wide system_prompt_text and iterate on prompt templates per annotator/layout as needed."}),"\n",(0,r.jsx)(t.li,{children:"For multimodal use (tables, visual extraction), ensure the prompt instructs the model to rely on both text and visual cues and to return normalized structure."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"3-add-the-annotator-config-entry",children:"3) Add the annotator config entry"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Open TID-layout_id/annotator/config.yml."}),"\n",(0,r.jsx)(t.li,{children:"Under annotators:, create a new key for your annotator (this is how you\u2019ll call it at runtime)."}),"\n",(0,r.jsx)(t.li,{children:"Provide annotator_type and model_config. For example:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'annotators:\n  my-new-annotator:\n    annotator_type: "llm"  # or "llm_table", "regex", etc.\n    model_config:\n      model_name: your_model_name\n      prompt_path: "./my-new-annotator.j2"   # relative to the annotator directory\n      system_prompt_text: >\n        ### Task\n        You are a helpful assistant that extracts <your-target> from the given text.\n      top_p: 1.0\n      frequency_penalty: 0\n      presence_penalty: 0\n      expect_output: "json"  # or "markdown" for table-like output\n    parser_name: default     # or a custom parser name, if applicable\n    validators:\n      - "domain_validator"\n      - "document_structure"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Notes:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"prompt_path is relative to the annotator directory for the selected layout."}),"\n",(0,r.jsx)(t.li,{children:'expect_output should align with your parser: usually "json" for fields; "markdown" for tables.'}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"4-parsers-and-validators-optional-but-recommended",children:"4) Parsers and validators (optional but recommended)"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Parsers convert model output into the system\u2019s canonical structures. Use parser_name: default for standard JSON responses, or specify a custom parser if your output format is specialized."}),"\n",(0,r.jsx)(t.li,{children:"Validators enforce schema, domain, and structural rules (e.g., document_structure, claims, tables). Add relevant validators under validators:."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Tip: Start with default parser + a minimal validator. Add stricter validators once your prompt stabilizes."}),"\n",(0,r.jsx)(t.h3,{id:"5-grounding-keys-and-layout-specific-settings",children:"5) Grounding keys and layout-specific settings"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Keep grounding keys and per-layout overrides in the child layout config (under TID-layout_id)."}),"\n",(0,r.jsx)(t.li,{children:"This enables fine-tuning the same annotator across different document families without changing global configuration."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"6-naming-and-conventions",children:"6) Naming and conventions"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Annotator key: short, kebab-case (e.g., claims, key-values, table-extract, remarks)."}),"\n",(0,r.jsx)(t.li,{children:"Output format: return data that matches expect_output and is compatible with the parser."}),"\n",(0,r.jsx)(t.li,{children:"Idempotency: designs should allow re-runs to skip work when outputs already exist for the same job/context."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"7-test-and-validate",children:"7) Test and validate"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Smoke test:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Use a small set of documents representative of the target layout."}),"\n",(0,r.jsx)(t.li,{children:"Ensure the annotator produces structured output in its output directory and that the parser accepts it."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["Validation:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Enable validators and confirm they pass on known-good samples."}),"\n",(0,r.jsx)(t.li,{children:"Add negative cases to ensure validators catch malformed output."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["Prompt iteration:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Adjust the Jinja2 prompt iteratively to stabilize field names, formats, and structure."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"8-performance-and-cost-tips",children:"8) Performance and cost tips"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Keep prompts concise and deterministic; anchor field names and expected schema."}),"\n",(0,r.jsx)(t.li,{children:"Set top_p conservatively (e.g., 1.0 or lower) for more predictable outputs."}),"\n",(0,r.jsx)(t.li,{children:"For large documents, consider page/region batching if supported by your workflow."}),"\n",(0,r.jsx)(t.li,{children:"For tables, prefer llm_table with multimodal: true when visual structure matters."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"9-troubleshooting",children:"9) Troubleshooting"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Prompt not found:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Verify prompt_path is correct and relative to TID-layout_id/annotator/."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["Output not parseable:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Align expect_output with your parser; update the prompt to produce strict JSON or Markdown."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["Inconsistent values:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Tighten prompts (explicit keys, formats), use validators, and consider a post-processor to normalize values (dates, amounts, enums)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["Cross-layout confusion:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Ensure the correct layout_id is selected at runtime so the correct config and prompts load."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"10-minimal-templates-to-copy",children:"10) Minimal templates to copy"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"New LLM annotator skeleton:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'annotators:\n  <your-key>:\n    annotator_type: "llm"\n    model_config:\n      model_name: <your-model>\n      prompt_path: "./your-key.j2"\n      system_prompt_text: >\n        ### Task\n        You are a helpful assistant that extracts <describe target>.\n      top_p: 1.0\n      frequency_penalty: 0\n      presence_penalty: 0\n      expect_output: "json"\n    parser_name: default\n    validators:\n      - "<your-domain>"\n      - "document_structure"\n'})}),"\n",(0,r.jsx)(t.p,{children:"ce a new annotator with minimal friction, keep configurations layout-scoped, and ensure outputs are predictable, parseable, and easy to validate."})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);