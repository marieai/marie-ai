"use strict";(self.webpackChunkmare_ai=self.webpackChunkmare_ai||[]).push([[5867],{23133:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"extract/processors/processors-add","title":"How to Create a New Region Processor (Hello World)","description":"This page walks you through creating a minimal \u201cHello World\u201d region processor that plugs into the extraction pipeline, registers itself, and produces a simple structured output.","source":"@site/docs/extract/processors/processors-add.md","sourceDirName":"extract/processors","slug":"/extract/processors/processors-add","permalink":"/docs/extract/processors/processors-add","draft":false,"unlisted":false,"editUrl":"https://github.com/marieai/marie-ai/tree/main/docs/docs/extract/processors/processors-add.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Extract/Processors","permalink":"/docs/category/extractprocessors"},"next":{"title":"Processor Purpose and Role in the Extraction Pipeline","permalink":"/docs/extract/processors/"}}');var o=r(74848),i=r(28453);const s={},a="How to Create a New Region Processor (Hello World)",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"1) Create a Processor Module",id:"1-create-a-processor-module",level:2},{value:"2) Make the Module Importable",id:"2-make-the-module-importable",level:2},{value:"3) Reference It in Configuration",id:"3-reference-it-in-configuration",level:2},{value:"4) Run and Verify",id:"4-run-and-verify",level:2},{value:"5) Testing Tips",id:"5-testing-tips",level:2},{value:"6) Extending Beyond \u201cHello World\u201d",id:"6-extending-beyond-hello-world",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"how-to-create-a-new-region-processor-hello-world",children:"How to Create a New Region Processor (Hello World)"})}),"\n",(0,o.jsx)(n.p,{children:"This page walks you through creating a minimal \u201cHello World\u201d region processor that plugs into the extraction pipeline, registers itself, and produces a simple structured output."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"A region processor:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Receives a matched section of a document (with spans/lines)."}),"\n",(0,o.jsx)(n.li,{children:"Transforms lines into a standardized structure (e.g., a table)."}),"\n",(0,o.jsx)(n.li,{children:"Returns a StructuredRegion with sections/blocks/rows."}),"\n",(0,o.jsx)(n.li,{children:"Is registered so the pipeline can discover and run it by name."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You\u2019ll create a new, minimal processor that always emits a single table with one row: \u201cHello, world!\u201d."}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Python 3.12 environment for the project."}),"\n",(0,o.jsx)(n.li,{children:"Basic understanding of how regions are matched and passed to processors."}),"\n",(0,o.jsx)(n.li,{children:"Access to add a new module under your processors package."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"1-create-a-processor-module",children:"1) Create a Processor Module"}),"\n",(0,o.jsx)(n.p,{children:"Create a new Python module (for example, under your processors/regions package) and implement a function decorated with the region-processor registry decorator. The function should accept the standard processing arguments and return a StructuredRegion."}),"\n",(0,o.jsx)(n.p,{children:"Example \u201chello_world_processor.py\u201d:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from typing import Dict, List\n\n# Import the registry and core types from your extraction framework\nfrom marie.extract.registry import register_region_processor\nfrom marie.extract.models.exec_context import ExecutionContext\nfrom marie.extract.models.match import MatchSection, Span\nfrom marie.extract.models.page_span import PageSpan\nfrom marie.extract.results.span_util import create_aggregate_span\nfrom marie.extract.results.role_util import normalize_role\n\nfrom marie.extract.structures.cell_with_meta import CellWithMeta\nfrom marie.extract.structures.line_with_meta import LineWithMeta\nfrom marie.extract.structures.structured_region import (\n    RowRole,\n    Section,\n    StructuredRegion,\n    TableBlock,\n    TableRow,\n    TableSeries,\n    build_structured_region,\n)\nfrom marie.extract.structures.table import Table\nfrom marie.extract.structures.table_metadata import TableMetadata\n\n\nPROCESSOR_SOURCE = "hello_world"\nTABLE_HEADERS = ["MESSAGE"]\n\n\n@register_region_processor(PROCESSOR_SOURCE)\ndef process_hello_world(\n    context: ExecutionContext,\n    parent: MatchSection,\n    section: MatchSection,\n    region_parser_config: Dict,\n    regions_config: List[Dict],\n) -> StructuredRegion:\n    # Aggregate span for the whole matched section\n    spans: List[Span] = section.span\n    aggregate_span: PageSpan = create_aggregate_span(spans)\n\n    # Resolve title/role from config, with safe defaults\n    region_cfg = regions_config[0] if regions_config else {}\n    title = region_cfg.get("title", "HELLO WORLD")\n    role_value = region_cfg.get("role", "main")\n    role, role_hint = normalize_role(role_value)\n\n    # Build a simple 1-column header\n    header_cells = [CellWithMeta(lines=[LineWithMeta(line=h)]) for h in TABLE_HEADERS]\n    header_row = TableRow(role=RowRole.HEADER, cells=header_cells)\n    table_grid: List[List[CellWithMeta]] = [header_cells]\n\n    # Add one data row with "Hello, world!"\n    data_cells = [CellWithMeta(lines=[LineWithMeta(line="Hello, world!")])]\n    data_row = TableRow(role=RowRole.BODY, cells=data_cells)\n    table_grid.append(data_cells)\n\n    # Table metadata (pick the first available line from the section if available)\n    # If a section line is not guaranteed, you can set page_id to 0 and omit source line.\n    page_id = 0\n    if spans and spans[0].page_from is not None:\n        page_id = int(spans[0].page_from)\n    table_meta = TableMetadata(page_id=page_id, title=title)\n\n    table = Table(cells=table_grid, metadata=table_meta)\n\n    # Wrap in a single segment series\n    segment = TableBlock(span=aggregate_span, table=table, rows=[header_row, data_row], segment_role="single")\n    series = TableSeries(segments=[segment], span=aggregate_span, unified_header=TABLE_HEADERS)\n\n    # Create a section and region\n    hello_section = Section(title=title, role=role, blocks=[series], span=aggregate_span)\n    if role_hint:\n        hello_section.tags["role_hint"] = role_hint\n\n    region = build_structured_region(\n        region_id="hello_world_region",\n        region_span=aggregate_span,\n        sections=[hello_section],\n    )\n\n    # Tag for provenance\n    region.tags["parsed"] = PROCESSOR_SOURCE\n    region.tags["processor_generated"] = "true"\n\n    return region\n'})}),"\n",(0,o.jsx)(n.p,{children:"Notes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The decorator registers the processor by name (\u201chello_world\u201d)."}),"\n",(0,o.jsx)(n.li,{children:"The function constructs a minimal Table with a single header and one data row."}),"\n",(0,o.jsx)(n.li,{children:"Provenance tags help trace outputs back to this processor."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"2-make-the-module-importable",children:"2) Make the Module Importable"}),"\n",(0,o.jsxs)(n.p,{children:["Ensure your package\u2019s ",(0,o.jsx)(n.strong,{children:"init"}),".py imports or otherwise exposes the new module so the registration decorator executes at import time. For example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from .hello_world_processor import process_hello_world  # noqa: F401\n"})}),"\n",(0,o.jsx)(n.h2,{id:"3-reference-it-in-configuration",children:"3) Reference It in Configuration"}),"\n",(0,o.jsx)(n.p,{children:"Wire your new processor into the pipeline by referencing its registered name in your region configuration. The exact structure may vary by your setup, but it typically includes the processor name and optional metadata like title/role."}),"\n",(0,o.jsx)(n.p,{children:"Example configuration snippet:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'# yaml\nregions:\n  - name: hello_world_demo\n    processor: hello_world\n    title: "HELLO WORLD"\n    role: "main"\n    match:\n      # Your matching strategy for when/how to invoke the processor\n      # For a demo, match a simple page or section span\n      type: "entire_document"  # or a specific rule in your system\n'})}),"\n",(0,o.jsx)(n.p,{children:"Key field:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"processor: must match the name used in @register_region_processor."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"4-run-and-verify",children:"4) Run and Verify"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Execute your pipeline with the configuration that includes the \u201chello_world\u201d region."}),"\n",(0,o.jsxs)(n.li,{children:["Inspect the resulting StructuredRegion:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"A section titled \u201cHELLO WORLD\u201d"}),"\n",(0,o.jsx)(n.li,{children:"One table with header \u201cMESSAGE\u201d"}),"\n",(0,o.jsx)(n.li,{children:"One row containing \u201cHello, world!\u201d"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Confirm that provenance tags indicate the processor ran."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"5-testing-tips",children:"5) Testing Tips"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Add a unit test that calls your processor with a synthetic section (one trivial span)."}),"\n",(0,o.jsxs)(n.li,{children:["Assert that:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The region contains exactly one section and one series/segment."}),"\n",(0,o.jsx)(n.li,{children:'The header equals ["MESSAGE"].'}),"\n",(0,o.jsx)(n.li,{children:"The first data cell contains \u201cHello, world!\u201d."}),"\n",(0,o.jsx)(n.li,{children:"The region tags include \u201cparsed: hello_world\u201d."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Example test skeleton:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def test_hello_world_processor_minimal():\n    # Arrange: build a minimal ExecutionContext and MatchSection with one span\n    # Act: call process_hello_world(...)\n    # Assert: verify StructuredRegion shape and "Hello, world!" content\n    ...\n'})}),"\n",(0,o.jsx)(n.h2,{id:"6-extending-beyond-hello-world",children:"6) Extending Beyond \u201cHello World\u201d"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Add more columns to TABLE_HEADERS for richer outputs."}),"\n",(0,o.jsx)(n.li,{children:"Populate rows from annotations/lines instead of a constant."}),"\n",(0,o.jsx)(n.li,{children:"Attach page/line provenance to each TableRow for traceability."}),"\n",(0,o.jsx)(n.li,{children:"Use configuration for titles, roles, or formatting."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Register a function with a unique processor name."}),"\n",(0,o.jsx)(n.li,{children:"Build and return a StructuredRegion with at least one table (header + row)."}),"\n",(0,o.jsx)(n.li,{children:"Expose the module so registration happens at import time."}),"\n",(0,o.jsx)(n.li,{children:"Reference it in your configuration and run the pipeline to see your \u201cHello, world!\u201d table in the output."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>a});var t=r(96540);const o={},i=t.createContext(o);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);