"use strict";(self.webpackChunkmare_ai=self.webpackChunkmare_ai||[]).push([[2612],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(96540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},43110:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"getting-started/contributing/contributing","title":"Contribute to MarieAI(\ud83e\udd8a)","description":"Thanks for your interest in contributing to MarieAi. We\'re grateful for your initiative! \u2764\ufe0f","source":"@site/docs/getting-started/contributing/contributing.md","sourceDirName":"getting-started/contributing","slug":"/getting-started/contributing/","permalink":"/docs/getting-started/contributing/","draft":false,"unlisted":false,"editUrl":"https://github.com/marieai/marie-ai/tree/main/docs/docs/getting-started/contributing/contributing.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"How to add a model","permalink":"/docs/getting-started/contributing/add_new_model"},"next":{"title":"Index","permalink":"/docs/contribute"}}');var r=i(74848),s=i(28453);const o={sidebar_position:1},a="Contribute to MarieAI(\ud83e\udd8a)",l={},c=[{value:"\ud83d\udc1e Bugs and Issues",id:"-bugs-and-issues",level:2},{value:"Submitting Issues",id:"submitting-issues",level:3},{value:"\u2611\ufe0f Naming Conventions",id:"\ufe0f-naming-conventions",level:2},{value:"Specify the correct types",id:"specify-the-correct-types",level:3},{value:"Downloading large artifacts",id:"downloading-large-artifacts",level:2},{value:"Development environment",id:"development-environment",level:2},{value:"Starting the server",id:"starting-the-server",level:3},{value:"Memory profiling",id:"memory-profiling",level:3},{value:"Testing for memory leaks",id:"testing-for-memory-leaks",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"contribute-to-marieai",children:"Contribute to MarieAI(\ud83e\udd8a)"})}),"\n",(0,r.jsx)(n.p,{children:"Thanks for your interest in contributing to MarieAi. We're grateful for your initiative! \u2764\ufe0f"}),"\n",(0,r.jsx)(n.p,{children:"In this guide, we're going to go through the steps for each kind of contribution, and good and bad examples of what to do. We look forward to your contributions!"}),"\n",(0,r.jsx)("a",{name:"-bugs-and-issues"}),"\n",(0,r.jsx)(n.h2,{id:"-bugs-and-issues",children:"\ud83d\udc1e Bugs and Issues"}),"\n",(0,r.jsx)(n.h3,{id:"submitting-issues",children:"Submitting Issues"}),"\n",(0,r.jsx)(n.p,{children:"We love to get issue reports. But we love it even more if they're in the right format. For any bugs you encounter, we need you to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Describe your problem"}),": What exactly is the bug. Be as clear and concise as possible"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Why do you think it's happening?"})," If you have any insight, here's where to share it"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"There are also a couple of nice to haves:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment:"})," You can find this with ",(0,r.jsx)(n.code,{children:"marie -vf"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Screenshots:"})," If they're relevant"]}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"coding-standards",children:"Coding standards"}),"\n",(0,r.jsx)(n.p,{children:"To ensure the readability of our code, we stick to a few conventions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["We format python files using ",(0,r.jsx)(n.code,{children:"black"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["For linting, we use ",(0,r.jsx)(n.code,{children:"flake81"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["For sorting imports, we use ",(0,r.jsx)(n.code,{children:"isort"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"setup.cfg"})," and ",(0,r.jsx)(n.code,{children:"pyproject.toml"})," already contain the proper configuration for these tools.\nIf you are working in a modern IDE (such a VSCode), which integrates these tools, the options will be picked up.\nIf you are working from the command line, you should use these tools form the root of this repository or via a ",(0,r.jsx)(n.code,{children:"make"})," file."]}),"\n",(0,r.jsx)(n.p,{children:"We also provide a .pre-commit-config.yaml file, which enables you to use pre-commit to automatically perform the required linting/formatting actions before you commit your changes.\nYou can install it using"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"pip install pre-commit\npre-commit install\n"})}),"\n",(0,r.jsx)("a",{name:"-naming-conventions"}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-naming-conventions",children:"\u2611\ufe0f Naming Conventions"}),"\n",(0,r.jsx)(n.p,{children:"For branches, commits, and PRs we follow some basic naming conventions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Be descriptive"}),"\n",(0,r.jsx)(n.li,{children:"Use all lower-case"}),"\n",(0,r.jsx)(n.li,{children:"Limit punctuation"}),"\n",(0,r.jsxs)(n.li,{children:["Include one of our specified ",(0,r.jsx)(n.a,{href:"#specify-the-correct-types",children:"types"})]}),"\n",(0,r.jsx)(n.li,{children:"Short (under 70 characters is best)"}),"\n",(0,r.jsxs)(n.li,{children:["In general, follow the ",(0,r.jsx)(n.a,{href:"https://www.conventionalcommits.org/en/v1.0.0/#summary",children:"Conventional Commit"})," guidelines"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Note: If you don't follow naming conventions, your commit will be automatically flagged to be fixed."}),"\n",(0,r.jsx)(n.h3,{id:"specify-the-correct-types",children:"Specify the correct types"}),"\n",(0,r.jsx)(n.p,{children:"Type is an important prefix in PR, commit message. For each branch, commit, or PR, we need you to specify the type to help us keep things organized. For example,"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"feat: add hat wobble\n^--^  ^------------^\n|     |\n|     +-> Summary in present tense.\n|\n+-------\x3e Type: build, ci, chore, docs, feat, fix, refactor, style, or test.\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"build: Changes that affect the build system or external dependencies (example scopes: gulp, broccoli, npm)"}),"\n",(0,r.jsx)(n.li,{children:"ci: Changes to our CI configuration files and scripts (example scopes: Travis, Circle, BrowserStack, SauceLabs)"}),"\n",(0,r.jsx)(n.li,{children:"docs: Documentation only changes"}),"\n",(0,r.jsx)(n.li,{children:"feat: A new feature"}),"\n",(0,r.jsx)(n.li,{children:"fix: A bug fix"}),"\n",(0,r.jsx)(n.li,{children:"perf: A code change that improves performance"}),"\n",(0,r.jsx)(n.li,{children:"refactor: A code change that neither fixes a bug nor adds a feature"}),"\n",(0,r.jsx)(n.li,{children:"style: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"test: Adding missing tests or correcting existing tests"}),"\n",(0,r.jsx)(n.li,{children:"chore: updating grunt tasks etc; no production code change"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"downloading-large-artifacts",children:"Downloading large artifacts"}),"\n",(0,r.jsx)(n.p,{children:"Often you will find that for the executor to work, a large file needs to be downloaded first - usually this would be a file with pre-trained model weights. If this is done at the start of the executor, it will lead to really long startup times, or even timeouts, which will frustrate users.\nIf this file is baked in the docker image (not even possible in all cases), this will create overly large docker images, and prevent users for optimizing storage in cases where they want to run multiple instances of the executor on the same machine, among other things."}),"\n",(0,r.jsx)(n.p,{children:"The solution in this case is to instruct users how to download the file before starting the executor, and then use that file in their executor. So for this case, you should:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add simple copy-pastable instructions on how to download the large files to the readme"}),"\n",(0,r.jsx)(n.li,{children:"Add instructions on how to specify the path to the file at executor initialization (if needed) and how to mount the file to a Docker container in the readme"}),"\n",(0,r.jsx)(n.li,{children:"If the file path is not provided, or the file doesn't exist, add an error telling the user that file needs to be downloaded, and pointing them to the readme for further instructions."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"development-environment",children:"Development environment"}),"\n",(0,r.jsxs)(n.p,{children:["If you wish to run and develop ",(0,r.jsx)(n.code,{children:"Marie-AI"})," directly, ",(0,r.jsx)(n.a,{href:"/docs/getting-started/installation#installing-from-source",children:"install it from source"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'git clone https://github.com/marieai/marie-ai.git\ncd marie-ai\ngit checkout develop\n\n# "-v" increases pip\'s verbosity.\n# "-e" means installing the project in editable mode,\n# That is, any local modifications on the code will take effect immediately\n\npip install  Cython\npip install "pybind11[global]"  # This prevents "ModuleNotFoundError: No module named \'pybind11\'"\n\nsudo apt-get install libpq-dev # Required to install psycopg2\n\n\npip install -r requirements.txt\npip install -v -e .\n'})}),"\n",(0,r.jsx)(n.p,{children:"Test your installation by running the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"marie --help\n"})}),"\n",(0,r.jsx)(n.h3,{id:"starting-the-server",children:"Starting the server"}),"\n",(0,r.jsx)(n.p,{children:"To start the server, run the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"marie server --start --uses /mnt/data/marie-ai/config/service/marie.yml\n"})}),"\n",(0,r.jsx)(n.p,{children:"For development purposes, you can also start the storage services in a separate container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"docker compose  --env-file ./config/.env -f ./Dockerfiles/docker-compose.s3.yml -f ./Dockerfiles/docker-compose.storage.yml --project-directory . up  --build --remove-orphans\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:" docker compose  --env-file ./config/.env  -f ./Dockerfiles/docker-compose.s3.yml -f Dockerfiles/docker-compose.rabbitmq.yml -f Dockerfiles/docker-compose.storage.yml --project-directory . up  --build --remove-orphans\n"})}),"\n",(0,r.jsx)(n.h3,{id:"memory-profiling",children:"Memory profiling"}),"\n",(0,r.jsxs)(n.p,{children:["Via the ",(0,r.jsx)(n.code,{children:"memray"})," command, you can profile the memory usage of the server :"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Script based profiling:"}),"\nREMEMBER TO SET ",(0,r.jsx)(n.code,{children:"PYTHONMALLOC=malloc"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"MARIE_DEFAULT_MOUNT=/mnt/data/marie-ai memray run --live ./marie/__main__.py server --start --uses /mnt/data/marie-ai/config/service/marie.yml\n\n PYTHONMALLOC=malloc  PYTHONUNBUFFERED=1;COLUMNS=180;CUDA_VISIBLE_DEVICES=0;GRPC_VERBOSITY=debug;JINA_MP_START_METHOD=spawn;MARIE_CACHE_LOCK_TIMEOUT=10;MARIE_DEBUG=0;MARIE_DEBUG_PORT=5678;MARIE_DEFAULT_MOUNT=/mnt/data/marie-ai;OPENAI_API_KEY=EMPTY;OPENAI_API_BASE=http://0.0.0.0:4000 memray run --live ./marie/__main__.py gateway --uses /mnt/data/marie-ai/config/service/marie-gateway-4.0.0.yml --protocols HTTP GRPC --ports 51000 52000 --extra-search-paths /mnt/data/marie-ai/config/extra_py_modules\n PYTHONMALLOC=malloc  PYTHONUNBUFFERED=1;COLUMNS=180;CUDA_VISIBLE_DEVICES=0;GRPC_VERBOSITY=debug;JINA_MP_START_METHOD=spawn;MARIE_CACHE_LOCK_TIMEOUT=10;MARIE_DEBUG=0;MARIE_DEBUG_PORT=5678;MARIE_DEFAULT_MOUNT=/mnt/data/marie-ai;OPENAI_API_KEY=EMPTY;OPENAI_API_BASE=http://0.0.0.0:4000 memray run --follow-fork  -o ~/tmp/memray/marie.bin ./marie/__main__.py gateway --uses /mnt/data/marie-ai/config/service/marie-gateway-4.0.0.yml --protocols HTTP GRPC --ports 51000 52000 --extra-search-paths /mnt/data/marie-ai/config/extra_py_modules\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Module based profiling:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:" JINA_MP_START_METHOD=fork PYTHONMALLOC=malloc MARIE_DEFAULT_MOUNT=/mnt/data/marie-ai memray run --follow-fork  -o ~/tmp/memray/marie.bin -m marie server --start --uses /mnt/data/marie-ai/config/service/marie.yml\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Profiling with a live remote:"}),"\nThis is useful as it allows us to observe logs and other information while the server is running."]}),"\n",(0,r.jsx)(n.p,{children:"Server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"MARIE_DEFAULT_MOUNT=/mnt/data/marie-ai memray run --live-remote -m marie server --start --uses /mnt/data/marie-ai/config/service/marie.yml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Remote :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"memray3.10 live\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing-for-memory-leaks",children:"Testing for memory leaks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"memray flamegraph --leaks ~/tmp/memray/marie.bin.3658615\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://bloomberg.github.io/memray/run.html"}),"\n",(0,r.jsx)(n.a,{href:"https://towardsdatascience.com/how-to-add-git-hooks-for-your-python-projects-using-the-pre-commit-framework-773acc3b28a7",children:"https://towardsdatascience.com/how-to-add-git-hooks-for-your-python-projects-using-the-pre-commit-framework-773acc3b28a7"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/about-issue-and-pull-request-templates",children:"https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/about-issue-and-pull-request-templates"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://flake8.pycqa.org/en/latest/",children:"https://flake8.pycqa.org/en/latest/"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);